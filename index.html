<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="Kwacha Money Transfer App - Send money online">
<meta name="keywords" content="money transfer, kwacha, online banking">
<meta name="robots" content="index, follow">
<meta name="author" content="Vainess Zulu">

<!-- Google Search Console Verification -->
<meta name="google-site-verification" content="wd3OH3QksxZ1ke7NSOJni3-sPFsnOutRPw7CM1KbQOI" />

<title>Kwacha Money Transfer App</title>

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">
<link rel="icon" href="movie/maly-192.png">
<meta name="theme-color" content="#c93232">

<!-- CSS -->
<link rel="stylesheet" href="./style.css">
<style>
    body {
        background-color: #000;
        color: #fff;
        font-family: 'Poppins', sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
    }

    input, button {
        padding: 10px;
        margin: 5px;
        border-radius: 5px;
        border: none;
    }

    button { cursor: pointer; background: #ff3d3d; color: #fff; }

    .hidden { display: none; }

    #usersList { margin-top: 20px; }
</style>
</head>
<body>

<!-- App Header -->
<h1>Kwacha Money Transfer App</h1>
<p>Send money securely using Kwacha</p>

<!-- Registration / Login -->
<div id="auth">
    <h2>Register / Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="registerOrLogin()">Register / Login</button>
</div>

<!-- Main app -->
<div id="app" class="hidden">
    <h2>Welcome, <span id="currentUser"></span></h2>
    <p>Balance: K<span id="balance">0</span></p>

    <h3>Transfer Money</h3>
    <input type="text" id="recipient" placeholder="Recipient username">
    <input type="number" id="amount" placeholder="Amount">
    <button onclick="transferMoney()">Send</button>

    <h3>Transaction History</h3>
    <ul id="history"></ul>

    <h3>Registered Users</h3>
    <ul id="usersList"></ul>

    <button onclick="logout()">Logout</button>
</div>

<script>
    // --- Service Worker Registration ---
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
            .then(() => console.log('Service Worker Registered'));
    }

    // --- Money Transfer App Logic ---
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    let currentUser = null;

    function saveUsers() {
        localStorage.setItem('users', JSON.stringify(users));
    }

    function registerOrLogin() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username || !password) return alert("Enter username and password!");

        if (!users[username]) {
            users[username] = { password: password, balance: 100, history: [] };
            alert("Account created with K100 starting balance!");
        } else {
            if (users[username].password !== password) return alert("Incorrect password!");
            alert("Logged in!");
        }

        currentUser = username;
        document.getElementById('auth').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        document.getElementById('currentUser').textContent = currentUser;
        updateUI();
        saveUsers();
    }

    function transferMoney() {
        const recipient = document.getElementById('recipient').value.trim();
        const amount = parseFloat(document.getElementById('amount').value);

        if (!recipient || isNaN(amount) || amount <= 0) return alert("Enter valid recipient and amount!");
        if (!users[recipient]) return alert("Recipient does not exist!");
        if (recipient === currentUser) return alert("Cannot send to yourself!");
        if (users[currentUser].balance < amount) return alert("Insufficient balance!");

        users[currentUser].balance -= amount;
        users[recipient].balance += amount;

        users[currentUser].history.push(`Sent K${amount} to ${recipient}`);
        users[recipient].history.push(`Received K${amount} from ${currentUser}`);

        updateUI();
        saveUsers();
        alert("Transfer successful!");
    }

    function updateUI() {
        document.getElementById('balance').textContent = users[currentUser].balance;

        const historyEl = document.getElementById('history');
        historyEl.innerHTML = '';
        users[currentUser].history.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            historyEl.appendChild(li);
        });

        const usersEl = document.getElementById('usersList');
        usersEl.innerHTML = '';
        Object.keys(users).forEach(user => {
            const li = document.createElement('li');
            li.textContent = user; // Only show username, no balance
            usersEl.appendChild(li);
        });
    }

    function logout() {
        currentUser = null;
        document.getElementById('auth').classList.remove('hidden');
        document.getElementById('app').classList.add('hidden');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }
</script>

</body>
</html>
